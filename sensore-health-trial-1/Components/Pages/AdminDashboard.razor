@page "/dashboard/admin"
@using Microsoft.AspNetCore.Authorization
@using sensore_health_trial_1.Services
@inject DashboardService DashboardService

<PageTitle>Admin Dashboard - Sensore GrapheneTrace</PageTitle>

<div class="admin-container">
    <!-- Header/Navigation -->
    <div class="admin-header">
        <div class="header-left">
            <img src="images/sensore.png" alt="Sensore Logo" class="header-logo" />
            <span class="header-brand">Admin Dashboard</span>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active">Dashboard</button>
            <button class="nav-tab">Users</button>
            <button class="nav-tab">Settings</button>
            <button class="nav-tab">Support</button>
        </div>

        <div class="header-right">
            <input type="text" class="search-input" placeholder="Search..." />
            <div class="user-avatar"></div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="admin-content">
        <!-- Overview Section -->
        <h2 class="section-title">Overview</h2>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <h3>Total Users</h3>
                    <div class="stat-dot" style="background-color: #000;"></div>
                </div>
                <div class="stat-value">@stats.TotalUsers</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <h3>Clinicians</h3>
                    <div class="stat-dot" style="background-color: #10b981;"></div>
                </div>
                <div class="stat-value">@stats.Clinicians</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <h3>Patients</h3>
                    <div class="stat-dot" style="background-color: #3b82f6;"></div>
                </div>
                <div class="stat-value">@stats.Patients</div>
            </div>

            <div class="stat-card">
                <div class="stat-header">
                    <h3>Pending Requests</h3>
                    <div class="stat-dot" style="background-color: #f59e0b;"></div>
                </div>
                <div class="stat-value">N/A</div>
            </div>
        </div>

        <!-- Charts and Activity Section -->
        <div class="charts-section">
            <div class="chart-card">
                <div class="chart-header">
                    <h3>New Users (Last 30 Days)</h3>
                    <select class="chart-dropdown">
                        <option>30 days</option>
                        <option>60 days</option>
                        <option>90 days</option>
                    </select>
                </div>
                <div class="chart-placeholder">
                    <svg viewBox="0 0 500 200" class="chart-svg">
                        <defs>
                            <linearGradient id="chartGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.3" />
                                <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:0.05" />
                            </linearGradient>
                        </defs>
                        <polyline points="20,150 60,130 100,120 140,110 180,90 220,80 260,85 300,70 340,75 380,60 420,50 460,45"
                                  fill="none" stroke="#3b82f6" stroke-width="2" />
                        <polygon points="20,150 60,130 100,120 140,110 180,90 220,80 260,85 300,70 340,75 380,60 420,50 460,45 460,200 20,200"
                                 fill="url(#chartGradient)" />
                    </svg>
                </div>
            </div>

            <div class="activity-card">
                <h3>Recent Activity</h3>
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-text">
                            <p class="activity-main">Clinician Rachel Green added 3 patients</p>
                            <p class="activity-time">2h ago</p>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-text">
                            <p class="activity-main">Admin approved clinician request</p>
                            <p class="activity-time">5h ago</p>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-text">
                            <p class="activity-main">Patient Andrei updated threshold</p>
                            <p class="activity-time">yesterday</p>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-text">
                            <p class="activity-main">2 users invited</p>
                            <p class="activity-time">yesterday</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Alerts Section -->
        <div class="alerts-section">
            <h3>System Alerts</h3>
            <div class="alerts-list">
                <div class="alert-item">
                    <div class="alert-text">
                        <p>3 clinician requests awaiting approval</p>
                    </div>
                    <button class="alert-view-btn">View</button>
                </div>
                <div class="alert-item">
                    <div class="alert-text">
                        <p>2 inactive accounts over 30 days</p>
                    </div>
                    <button class="alert-view-btn">View</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="admin-footer">
        <p>Contact us · About · FAQ</p>
    </div>
</div>

@code {
    private DashboardStats stats = new();

    protected override async Task OnInitializedAsync()
    {
        stats = await DashboardService.GetDashboardStatsAsync();
    }
}
